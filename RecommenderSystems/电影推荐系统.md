# 第八次作业——电影推荐系统

### 文件说明

- data.csv文件：将movies.csv和ratings.csv两个文件的数据整合成一个便于使用的有效数据集，其中分为三列，分别是用户ID、电影ID、用户对电影的评分；
- movie_temp.csv文件：用户ID未经排序的电影推荐结果文件；
- movie.csv文件：最终的电影推荐结果文件。

### 处理思路

1. 主要思想：

   1. 基于用户的协同过滤推荐算法；
      1. 如果用户user1与用户user2相似，并且user2喜欢该电影，那么user1也可能喜欢该电影；
      2. 预估用户user对侯选电影movieId的兴趣：![image-20221030153014979](C:\Users\H\AppData\Roaming\Typora\typora-user-images\image-20221030153014979.png)
      3. 计算两个用户的相似度
         1. 把每个用户表示为一个稀疏向量，向量每个元素对应一部电影；
         2. 相似度sim就是两个向量夹角的余弦。

2. 算法思路：

   1. 数据处理

      使用movies.csv和ratings.csv两个文件的数据userId、movieId、rating数据，构成用户、电影、评分数据集，便于后续用于计算用户相似度时的数据处理；

   2. 电影推荐

      分别对每一位用户进行以下步骤：

      ​	找到与该用户最相似的前userNum位用户，并将相似用户评分排名前resultNum部电影推荐给该用户（其中userNum设定为5，resultNum设定为10，即将与该用户相似度最高的前五位用户综合得到评分排名前十的电影推荐给该用户）

      以上过程可具体分为两部分，即

      1. 找到与该用户最相似的前五位用户；
      2. 将相似用户评分排名前十的电影推荐给该用户；

   3. 结果保存

      将电影推荐结果以userId、movieId的形式保存到文件movie.csv文件中。

### 实现步骤

根据算法思路，分别将每个步骤进行细化：

1. 数据处理

   1. 为了使用movies.csv和ratings.csv两个文件的userId、movieId、rating数据，构成用户、电影、评分数据集，首先将两个文件的所有数据进行提取，并且去除不需要的列title、genres、timestamp，将其存储为新的用户-电影-评分数据集data.csv；
   2. 为了便于后续继续进行数据读取，使用字典data存储该数据集，格式为{用户1：{电影1：评分1，电影2：评分2···}，用户2：{电影1：评分1，电影2：评分2···}，···}。（因为data.csv文件中的rating一列为str类型，需要提前将其转化为int类型，便于后续进行用户相似度计算）。

2. 电影推荐

   分别对data数据集中的每一位用户进行以下步骤：

   1. 找到与该用户最相似的前五位用户

      由于目前得到的数据集是data字典，为每位用户对应的多部电影以及对该电影的评分，为了寻找与该用户最相似的前五位用户，需要计算该用户与其他用户的相似度，这里通过计算余弦相似度来表示用户之间的相似度，具体步骤为：

      1. 建立电影-用户的倒排表。通过遍历data字典，遍历用户对应的电影数据，并将每一部电影对应的已对其进行评分的用户进行记录，最后使用字典movieId_userId进行存储，得到的字典形式为{电影1：{用户1，用户2···}，电影2：{用户1，用户2···}，···}；
      2. 计算用户-用户的相关性矩阵。建立用户-用户共现矩阵和用户-电影数矩阵，并分别使用字典uuMatrix、umMatrix进行存储，其中用户-用户共现矩阵形式为{用户1：{用户1：共同观看过的电影数1，用户2：共同观看过的电影数2，···}，用户2：{用户1：共同观看过的电影数1，用户2，共同观看过的电影数2，···}，···}，即为存储当两位用户如果都对同一部电影已评分则其值加1的数据集；用户-电影数矩阵的形式为{用户1：电影数1，用户2：电影数2，···}，即为用户已评分的电影部数，从而得到用户-用户的相关性矩阵；
      3. 计算用户之间的余弦相似度。建立用户相似度矩阵，并通过字典similarityMatrix进行存储。遍历用户-用户共现矩阵的所有项，并遍历其他每一个用户及对应的共现矩阵的值（分子部分），应用余弦相似度计算公式计算用户之间的相似度；
      4. 将得到的用户相似度矩阵按照相似度从大到小进行排序。

   2. 将相似用户评分排名前十的电影推荐给该用户

      1. 使用字典movieRank存储该用户对每部电影的评分值。取与该用户相似度排名前五的用户，遍历所有电影和这五位用户对该电影的评分值，同时去除该用户已评分的电影，通过与其相似用户对该电影的评分与相似度相乘得到该用户对该电影的评分值，并保存到movieRank中；
      2. 按照评分值大小，为该用户推荐movieRank中排名前十的电影。

3. 结果保存

   1. 将每一位用户得到的电影推荐结果依次写入movie_temp.csv文件中；
   2. 读取movie_temp.csv文件中的数据，按照USERID对其进行排序，并将结果保存到movie.csv文件中。

   